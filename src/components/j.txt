function addDataToFb(data, row_no) {
  const base = "firebase realtime database link";
  const keys = ["Organisation", "Program", "Focus_Area", "Grant_Support", "Deadline", "Link"];

  keys.forEach(function(key) {
    const value = data[key];
    const url = base + key + "/row_" + row_no + ".json"
    const options = {
      method: "put",
      contentType: "application/json",
      payload: JSON.stringify(value)
    }

    const response = UrlFetchApp.fetch(url, options);
    Logger.log("Updated " + key + "/row_" + row_no + " with value: " + value );
    })
}

function clearBase() {
  const base = "firebase realtime database link";
  const keys = ["Organisation", "Program", "Focus_Area", "Grant_Support", "Deadline", "Link"];

  keys.forEach(function(key) {
    const url = base + key + ".json";
    const options = {
      method: "delete"
    };
    UrlFetchApp.fetch(url, options);
    Logger.log("Deleted all data under: " + key);
  });
}

/**@customfunction */
function sendDataToFb() {
  var row = 0
  var ws = SpreadsheetApp.getActiveSpreadsheet().getSheetByName("datasheet");
  clearBase();
  for(var i = 2; i <= ws.getLastRow(); i++){
    addDataToFb(
      {
        "Organisation" : ws.getRange("A"+i).getValue(),
        "Program" : ws.getRange("B"+i).getValue(),
        "Focus_Area" : ws.getRange("C"+i).getValue(),
        "Grant_Support" : ws.getRange("D"+i).getValue(),
        "Deadline" : ws.getRange("E"+i).getValue(),
        "Link" : ws.getRange("F"+i).getValue(),
      }, row
    )
    row+=1;
  }
}

/**@customfunction */
function updateRows() {
  var ws = SpreadsheetApp.getActiveSpreadsheet().getSheetByName("datasheet");
  var rowCountSheet = ws.getLastRow();

  var nodeUrl = "firebase realtime database link/Organisation.json";
  var response = UrlFetchApp.fetch(nodeUrl);
  var data = JSON.parse(response.getContentText());
  var rowCount = Object.keys(data).length;

  if((rowCountSheet - (rowCount + 1)) > 0){
    var row = rowCount
    for(var i = rowCount + 2; i <= ws.getLastRow(); i++){
    addDataToFb(
      {
        "Organisation" : ws.getRange("A"+i).getValue(),
        "Program" : ws.getRange("B"+i).getValue(),
        "Focus_Area" : ws.getRange("C"+i).getValue(),
        "Grant_Support" : ws.getRange("D"+i).getValue(),
        "Deadline" : ws.getRange("E"+i).getValue(),
        "Link" : ws.getRange("F"+i).getValue(),
      }, row
    )
    row+=1;
  }
  }
}